<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="../lib/d3.min.js"></script>
    <script src="../lib/jquery-3.5.1.min.js"></script>
    <style>
        body {
            overflow: hidden;
            border: 0;
            margin: 0;
            padding: 0;
        }

        #main {
            width: 100%;
            height: 100%;
            position: absolute;
        }
    </style>
</head>
<body>
<div id="main"></div>
<script>
    let width = $('#main').width(),
        height = $('#main').height(),
        margin = {left: 10, top: 10, right: 10, bottom: 10},
        clipWidth = width - margin.left - margin.right,
        clipHeight = height - margin.top - margin.bottom;

    let svg = d3.select('#main').append('svg')
        .attr('width', width)
        .attr('height', height)
        .append('g')
        .attr('transform', `translate(${margin.left}, ${margin.top})`);

    let fill = d3.schemeCategory10;

    let nodes = [],
        foci = [{x: 150, y: 150}, {x: 350, y: 250}, {x: 700, y: 400}];

    let simulation = d3.forceSimulation(nodes)
        .force('charge', d3.forceManyBody())
        // .force('collide')
        .on('tick', tick)

    simulation.stop();

    let node = svg.selectAll("circle");

    function tick() {
        let k = 0.1 * simulation.alpha();

        // Push nodes toward their designated focus.
        nodes.forEach(function (o, i) {
            o.y += (foci[o.id].y - o.y) * k;
            o.x += (foci[o.id].x - o.x) * k;
        });

        node
            .attr("cx", function (d) {
                return d.x;
            })
            .attr("cy", function (d) {
                return d.y;
            });
    }

    setInterval(function () {
        nodes.push({id: ~~(Math.random() * foci.length)});
        simulation.nodes(nodes).alphaTarget(0.5).restart();

        node = node
            .data(nodes)
            .join(
                enter => enter.append('circle')
                    .attr("class", "node")
                    .attr("cx", function (d) {
                        return d.x;
                    })
                    .attr("cy", function (d) {
                        return d.y;
                    })
                    .attr("r", 8),
                update => update
                    .attr("class", "node")
                    .attr("cx", function (d) {
                        return d.x;
                    })
                    .attr("cy", function (d) {
                        return d.y;
                    })
                    .attr("r", 8),
                exit => exit.remove()
            );
    }, 500);
</script>
</body>
</html>