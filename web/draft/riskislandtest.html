<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="../lib/d3.min.js" type="text/javascript"></script>
    <script src="../lib/jquery-3.5.1.min.js" type="text/javascript"></script>
    <script src="../lib/lodash.js" type="text/javascript"></script>
    <script src="../lib/mapbox-gl.js" type="text/javascript"></script>
    <script src="../script/d3.riskLayout.js" type="text/javascript"></script>

    <style>
        body {
            padding: 0;
            margin: 0;
            border: 0;
            overflow: hidden;
        }

        #main {
            position: absolute;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
<div id="main"></div>
<script>
    let width = $('#main').width(),
        height = $('#main').height(),
        margin = {left: 30, right: 30, bottom: 30, top: 30},
        clipWidth = width - margin.left - margin.right,
        clipHeight = height - margin.top - margin.bottom,
        hypotenuse = Math.sqrt(width * width + height * height);

    let svg = d3.select('#main').append('svg')
        .attr('width', width)
        .attr('height', height)
        .append('g')
        .attr('transform', `translate(${margin.left}, ${margin.top})`);

    let contour = d3.contourDensity()
        .x(d => d.x)
        .y(d => d.y)
        .size([clipWidth, clipHeight])
        .bandwidth(8)
        .thresholds(20);

    let segmentScale = d3.scaleLinear()
        .domain([0, hypotenuse])
        .range([1, 10]);

    let contour_g = svg.append('g')
        .attr('class', 'tnet_contour_g');

    let bundle_g = svg.append('g')
        .attr('class', 'tnet_bundle_g');

    let node_g = svg.append('g')
        .attr('class', 'tnet_node_g');

    let gc = {
        node: node_g,
        edge: bundle_g,
        contour: contour_g
    };

    d3.json('../data/graptolites-tnet-20220117.json').then(function (data) {
        let xScale = d3.scaleLinear()
            .range([0, clipWidth]);

        let yScale = d3.scaleLinear()
            .range([clipHeight, 0]);

        drawRiskLayout(gc, data, xScale, yScale, segmentScale, contour);

        console.log(d3.selectAll('.node').filter(d => d.y < 0).data())
    })
</script>
</body>
</html>